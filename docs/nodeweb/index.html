<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="../lib/bulma.min.css"><link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="../lib/prism.css"><link rel="icon" href="../img/page-icon.png"><meta property="og:type" content="website"><meta property="og:site_name" content="INFO Tutorials"><meta property="og:title" content="Microservices with Node.js"><meta property="og:description" content="Building focused web services in JavaScript"><meta property="og:image" content="https://drstearns.github.io/tutorials/img/page-icon.png"><title>Microservices with Node.js</title><style>.is-funky{background-image:linear-gradient(to right,#006064,#880E4F)}.is-funky .subtitle,.is-funky .title{color:#fff}.screenshot{border:1px dotted #ccc;padding:10px;margin-bottom:1em}.bookmark-link{color:#ddd;margin-left:.25em}.home-link{color:#eee}.home-link:hover{color:#fff}.byline{font-size:.85rem;font-style:italic}.shaded{background-color:#eee}</style></head><body><header><div class="hero is-funky"><div class="hero-body"><div class="container"><div class="columns is-mobile"><div class="column"><h1 class="title">Microservices with Node.js</h1><p class="subtitle">Building focused web services in JavaScript</p></div><div class="column is-narrow"><a href=".." class="home-link"><span class="icon is-medium"><i class="fa fa-home" aria-hidden="true" aria-label="back to table of contents"></i></span></a></div></div></div></div></div></header><main class="section"><div class="container"><div class="content"><p class="byline">Last edited on Oct 23, 2017 by <a href="https://ischool.uw.edu/people/faculty/dlsinfo">Dave Stearns</a></p><p>You can build a web server in any language that allows you to listen on a port for HTTP requests, and respond accordingly. So far we've <a href="../goweb/">seen how to do that in Go</a>, but you can build web servers in many different languages, including JavaScript.</p><p>Some students find it difficult to understand how one could build a web <em>server</em> in JavaScript because their only use of JavaScript thus far was in the web browser. But the web browser is only one possible execution environment for the general JavaScript language. Shortly after Google open-sourced their V8 JavaScript interpreter, a few enterprising folks realized they could use it to run JavaScript at the command-line. And if they injected a few global functions and objects written in C, they could allow that JavaScript to do all kinds of fun things: read from/write to the file system; listen on ports and write responses; make network requests and process the results; etc.</p><p>The project was named "Node.js" because they wanted to use this runtime engine primarily for writing low-level network services. But their first release in 2011 also included a basic HTTP server that allowed one to build a full web service in JavaScript (albeit with a lot of effort).</p><p>Web server frameworks from the Ruby on Rails world were quickly ported over to this new exciting platform, the most popular of them being <a href="https://expressjs.com/">Express.js</a>. These frameworks make it easier to build full-featured web servers on top of Node's somewhat minimalist HTTP module, so they are very commonly used. Express is now starting to show its age, and new frameworks based on ES6 features are starting to vie for dominance (e.g., <a href="http://koajs.com/">Koa.js</a>).</p><h2 id="secgettingsetup">Getting Setup</h2><p>Since JavaScript is an interpreted language, the Node.js runtime must be installed on any machine that will run your code. Node.js also comes with the <code>npm</code> package manager, which helps you install various open-source packages, including Express.js.</p><h3 id="secmacusers">Mac Users</h3><p>If you are on a Mac and you have <a href="https://brew.sh/">homebrew</a> installed, use it to install Node.js:</p><pre class="language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># Mac Homebrew users</span>
brew <span class="token function">install</span> node</code></pre><p>If you don't want to use homebrew, <a href="https://nodejs.org/en/download/current/">download and run the Node.js installer</a> for Mac.</p><h3 id="secwindowsusers">Windows Users</h3><p>If you are on Windows, <a href="https://nodejs.org/en/download/current/">download and run the Node.js installer</a> for Windows.</p><h3 id="seclinuxusers">Linux Users</h3><p>If you are on Linux, <a href="https://nodejs.org/en/download/package-manager/">follow the installation instructions for your distro</a>.</p><h2 id="secstartinganewproject">Starting a New Project</h2><p>Create a new directory somewhere on your development machine and <code>cd</code> into that directory (unlike Go, Node.js doesn't have a central workspace directory, so you can create this directory anywhere). To start a new Node.js project in that directory run this command:</p><pre class="language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># creates a new package.json file</span>
<span class="token function">npm</span> init -y</code></pre><p><code>npm</code> is the package manager installed with the Node.js runtime, and it has several sub-commands. The <code>init</code> command creates a new <code>package.json</code> file, which is used to track meta-data about your project (a "package" in npm-speak). By default it uses the directory name as your package name, and if that directory is a git repository, it will also add a <code>repository</code> key containing the URL to your <code>origin</code> remote (i.e., URL to your repo on GitHub). You should add and commit this file to your git repo</p><p>This <code>package.json</code> file will also track all the other packages your package depends upon. So far that is blank, but let's add a few dependencies:</p><pre class="language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># installs packages and records dependencies in package.json</span>
<span class="token function">npm</span> <span class="token function">install</span> --save express body-parser morgan</code></pre><p>The <code>install</code> sub-command will download the packages you name from the <a href="https://www.npmjs.com/">central npm package repository</a> and install them into a <code>node_modules</code> sub-directory. These packages are just a bunch of JavaScript that someone else wrote, so you can look inside that directory and read all the code.</p><p>Since anyone can publish packages to this repository, be careful how you spell the names of the packages you want to install. There have already been several <a href="https://www.theregister.co.uk/2017/08/02/typosquatting_npm/">typosquatting attacks</a> where developers published packages with names very similar to the most popular packages, but containing malicious code.</p><p>The <code>--save</code> option not only downloads and installs the packages, but also adds them to the <code>dependencies</code> key in your <code>package.json</code> file. After you add/commit the updated <code>package.json</code> file to your repo, other developers will be able not know which packages this project depends upon. Those other developers will also be able to install all dependencies with the simple command:</p><pre class="language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># installs all dependencies listed in package.json</span>
<span class="token function">npm</span> <span class="token function">install</span></code></pre><h2 id="secbuildinganhttpserver">Building an HTTP Server</h2><p>The three packages we installed above are as follows:</p><ul><li><code>express</code>: a popular web server framework that makes it easy to build HTTP servers</li><li><code>body-parser</code>: middleware that automatically decodes JSON in request bodies</li><li><code>morgan</code>: request logging middleware</li></ul><p>As described in the <a href="../gomiddleware">Middleware Patterns in Go</a> tutorial, middleware is code that can do pre- and post-processing of every request. The Express.js framework has <a href="http://expressjs.com/en/guide/using-middleware.html">built-in support for middleware</a>, and there are <a href="http://expressjs.com/en/resources/middleware.html">many middleware packages</a> already in existence that do just about everything you'd ever need to do.</p><p>To see how you can use the Express.js framework and these middleware packages, let's create a simple HTTP server. Create a new file in your project directory named <code>index.js</code>, open it in your favorite code editor, and add this to it:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//put interpreter into strict mode</span>
<span class="token string">"use strict"</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//require the express, body-parser, and morgan packages</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"body-parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> morgan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"morgan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//create a new express application</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>"use strict";</code> directive is always a good idea to add, as it <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">disables several forgiving JavaScript features</a> that make it very easy to introduce subtle bugs.</p><p>The <code>require()</code> function is a global function added by Node when it executes your script. This function loads packages from your <code>node_modules</code> sub-directory, or your own packages defined in other files. If the string you pass does not start with <code>./</code> or <code>../</code>, the function will look for a sub-directory within <code>node_modules</code> that matches the supplied name (e.g., <code>node_modules/express</code>). If the string does start with <code>./</code> or <code>../</code>, the function will treat that as a relative path to the other JavaScript file.</p><p>The <code>require()</code> function loads the requested package and returns a reference to the package's exported API. This API might be a JavaScript object with several properties and methods, or it might be a single function. The <code>express</code> package exports a single function that you can use to create a new Express application, which is what we do in that last line.</p><p>You might be wondering why I used <code>const</code> instead of <code>var</code>: because our code will run by the Node.js runtime, and because we control which version of that runtime is used, it's safe to use newer JavaScript features, including all of the ES6 features supported by the V8 interpreter. Since the value of <code>express</code> should never be change during our script, it's best to use <code>const</code> to define it.</p><h3 id="secreadingenvironmentvariables">Reading Environment Variables</h3><p>Just as we did when we wrote web servers in Go, it's good practice to let those running your web server specify the network address at which the server should listen. An easy way to do that is via an environment variable. Node exposes all environment variables via the global <code>process.env</code> object. Each environment variable is a key on that object:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//get ADDR environment variable,</span>
<span class="token comment" spellcheck="true">//defaulting to ":80"</span>
<span class="token keyword">const</span> addr <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>ADDR <span class="token operator">||</span> <span class="token string">":80"</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//split host and port using destructuring</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>host<span class="token punctuation">,</span> port<span class="token punctuation">]</span> <span class="token operator">=</span> addr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>After getting the <code>ADDR</code> environment variable, we use an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">ES6 destructuring assignment</a> to split apart the host and port segments of the address. The express application will make us pass these values separately to its <code>.listen()</code> method, so we have to split the address apart.</p><p>It's safe to use this new destructuring assignment because we control the version of the interpreter running our code. It's also safe to destructure the result of <code>.split()</code>: asking for an array index that doesn't yet exist simply returns <code>undefined</code> in JavaScript, with no runtime error.</p><h3 id="secaddingthemiddleware">Adding the Middleware</h3><p>Next add the JSON body-parsing and request-logging middleware to your express application:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//add the JSON request body parsing middleware</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//add the request loggin middleware</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">"dev"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Global middleware that should be invoked on every request are added using <code>app.use()</code>. The <code>body-parser</code> package's <a href="https://github.com/expressjs/body-parser#api">API</a> is an object with several methods, and here we invoke the <code>.json()</code> method to get a reference to the JSON-parser middleware handler. This middleware function will automatically parse any JSON in the request body, making it available to our handlers as a <code>body</code> property on the request object.</p><p>The <code>morgan</code> package's <a href="https://github.com/expressjs/morgan#api">API</a> is a single function that takes a request logging format string, or a function that does custom formatting. In this case we use the predefined <code>"dev"</code> logging format, which is helpful when doing development. The middleware handler function returned from <code>morgan("dev")</code> will log each request to standard out.</p><p>As opposed to middleware in Go, each of these middleware handler functions are being added to a chain of functions that are called during each request. When the first one finishes, it specifically tells Express to call the next function in the chain. If a handler function in the chain doesn't tell Express to call the next handler in the chain, the processing of the request ends.</p><h3 id="secaddingyourownhandlers">Adding Your Own Handlers</h3><p>Next add a handler for <code>GET</code> requests to the root resource path <code>/</code>:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//add handler for `GET /`</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/plain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello, Node.js!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Handlers are added by invoking a method on the application that has the same name as the HTTP method you want to handle: in this case <code>app.get()</code> for an HTTP <code>GET</code> request. The first parameter is the resource path you want to handle requests for, and the second is a JavaScript function that will be invoked when the server receives a request for that resource path, using that HTTP method.</p><p>If you want your handler function to be called for <em>any</em> HTTP method, then call <code>app.use()</code> instead, but still pass the resource path as the first parameter. It will then be up to your code to example the actual HTTP method on the request object.</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//handler for *any* HTTP method</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//req.method contains the actual request method</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//...cases for different methods</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>For the handler function itself, we are using an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">ES6 lambda-style function</a>, also known as an "arrow function." This simply new-fangled syntax for a more traditional in-line anonymous function, so the following is equivalent:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//equivalent to code above</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/plain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello, Node.js!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p><strong>NOTE:</strong> JavaScript lambda functions do have an important difference from traditional in-line anonymous functions: the <code>this</code> keyword is lexically-scoped in the former, where it's globally-scoped (by default) in the latter. In this case it doesn't matter, as we aren't using the <code>this</code> keyword in the handler function, and there would be little reason to do so.</p></blockquote><p>Express handler functions are passed three parameters:</p><ul><li><code>req</code>: an object containing <a href="https://expressjs.com/en/4x/api.html#req">information about the request</a></li><li><code>res</code>: an object that lets you <a href="https://expressjs.com/en/4x/api.html#res">send responses back to the client</a></li><li><code>next</code>: a function to call if you <a href="https://expressjs.com/en/guide/error-handling.html">encounter an error</a>, or if you want other handler functions registered for the same resource path and method to be invoked.</li></ul><p>The <code>req</code> parameter is similar to the <code>*http.Request</code> in Go, and the <code>res</code> parameter is similar to the <code>http.ResponseWriter</code> in Go.</p><p>The <code>next</code> parameter is unique to Express: specific resource path handlers like this one typically handle the request and therefore don't need to invoke the next handler in the chain, so they only call <code>next()</code> to report an error. General middleware handlers added to the beginning of the chain call <code>next()</code> once they have finished their preprocessing work. This triggers Express to call the next handler in the chain, until some handler (like our specific resource path handler above) doesn't call <code>next()</code>. At that point, the request processing is finished.</p><h3 id="secstartlisteningforrequests">Start Listening for Requests</h3><p>After adding your various resource path handlers, the last thing to do is tell the application to listen on the requested host and port:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//start the server listening on host:port</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> host<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//callback is executed once server is listening</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`server is listening at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>addr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Note that the <code>port</code> number comes first, followed by the <code>host</code>. You can omit the <code>host</code> parameter, and the server will then listen for requests sent to any host.</p><p>The last parameter can be a function that will be invoked once the server has bound to the port. Here we provide a function that simply writes a message to standard out that the server is listening at the requested address. We use the new <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">ES6 template strings</a> feature to dynamically insert the value of the <code>addr</code> variable into the middle of the string.</p><h2 id="sectryitout">Try it Out!</h2><p>At this point your script is ready to run. In your terminal, run these commands to start the server:</p><pre class="language-bash"><code class="language-bash"><span class="token function">export</span> ADDR<span class="token operator">=</span>localhost:4000
node index.js</code></pre><p>The first command sets the <code>ADDR</code> environment variable so that our server will listen on port 4000 and only accept requests through the loopback address. The second command runs our script using the Node.js runtime engine.</p><p>If you did everything correctly, you should see the message <code>server is listening at http://localhost:4000...</code> printed to your terminal, but you won't get your prompt back. Since the server is still running, it occupies that terminal window. You'll see the request logging messages printed there.</p><p>Now open <a href="http://localhost:4000">http://localhost:4000</a> in your web browser. You should see "Hello, Node.js!" as the response. Congratulations! You just wrote your first Node/Express web server!</p><h2 id="secrespondingwithjson">Responding with JSON</h2><p>In the example above, we responded to the client with plain text, but Express also makes it very easy to respond with JSON instead. For example:</p><pre class="language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/v1/channels"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//assuming some function that gets all</span>
    <span class="token comment" spellcheck="true">//of the defined channel records from the database </span>
    <span class="token keyword">let</span> allChannels <span class="token operator">=</span> <span class="token function">getAllChannelsFromDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//write those to the client, encoded in JSON</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>allChannels<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>.json()</code> method on the response object accepts any value, runs it through <code>JSON.stringify()</code>, and writes the result to the client. It also sets the <code>Content-Type</code> header to <code>application/json</code> automatically, so you don't have to do that yourself.</p><h2 id="secerrorhandling">Error Handling</h2><p>As noted earlier, specific resource handlers don't typically call the <code>next()</code> function unless they need to report an error. By default, if your JavaScript handler function throws an exception, Express will catch that exception and write the error with a full stack trace back to the client. That's fine during development, but a stack trace in the response doesn't look very professional in production, and it does leak information that could be helpful to an attacker.</p><p>To handle errors more appropriately, add one more handler function to your Express application, but this time, define it to take four parameters instead of three:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//error handler that will be called if</span>
<span class="token comment" spellcheck="true">//any handler earlier in the chain throws</span>
<span class="token comment" spellcheck="true">//an exception or passes an error to next()</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//write a stack trace to standard out,</span>
    <span class="token comment" spellcheck="true">//which writes to the server's log</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//but only report the error message</span>
    <span class="token comment" spellcheck="true">//to the client, with a 500 status code</span>
    res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/plain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The first parameter <code>err</code> will be a reference to the <code>Error</code> object that was thrown by the handler, or passed to the <code>next()</code> function. The other three are the same as the ones passed to any other handler.</p></div></div></main><footer class="footer"><div class="container"><div class="content"><p>Created by <a href="https://ischool.uw.edu/people/faculty/dlsinfo">Dave Stearns</a>, <a href="https://ischool.uw.edu">The Information School</a>, <a href="https://uw.edu">University of Washington</a></p><p><a href=".."><span class="icon"><i class="fa fa-home"></i> </span>back to contents</a></p></div></div></footer><script>var headings=document.querySelectorAll("h2,h3,h4,h5");headings.forEach(function(e){var a=document.createElement("a");a.textContent="#",a.href="#"+e.id,a.classList.add("bookmark-link"),e.appendChild(a)})</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-102177301-1","auto"),ga("send","pageview")</script></body></html>