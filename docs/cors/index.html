<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="../lib/bulma.min.css"><link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="../lib/prism.css"><link rel="icon" href="../img/page-icon.png"><meta property="og:type" content="website"><meta property="og:site_name" content="INFO Tutorials"><meta property="og:title" content="Cross-Origin Resource Sharing"><meta property="og:description" content="Enable JavaScript from different origins to call your APIs"><meta property="og:image" content="https://drstearns.github.io/tutorials/img/page-icon.png"><title>Cross-Origin Resource Sharing</title><style>.is-funky{background-image:linear-gradient(to right,#006064,#880E4F)}.is-funky .subtitle,.is-funky .title{color:#fff}.bookmark-link{color:#ddd;margin-left:.25em}.home-link{color:#eee}.home-link:hover{color:#fff}.byline{font-size:.85rem;font-style:italic}</style></head><body><header><div class="hero is-funky"><div class="hero-body"><div class="container"><div class="columns is-mobile"><div class="column"><h1 class="title">Cross-Origin Resource Sharing</h1><p class="subtitle">Enable JavaScript from different origins to call your APIs</p></div><div class="column is-narrow"><a href=".." class="home-link"><span class="icon is-medium"><i class="fa fa-home" aria-hidden="true" aria-label="back to table of contents"></i></span></a></div></div></div></div></div></header><main class="section"><div class="container"><div class="content"><p class="byline">Last edited on Jul 16, 2017 by <a href="https://ischool.uw.edu/people/faculty/dlsinfo">Dave Stearns</a></p><p>Back in the early 2000s, web browsers started allowing JavaScript to make HTTP requests without requiring a page navigation. This was very exciting, as it enabled a new form of web application that felt more like a native desktop application. But the browser vendors faced a difficult question: should we allow JavaScript to make requests to a different <a href="../http/#secorigin">origin</a> than the origin the current page came from? In other words, should JavaScript loaded into a page served from <code>example.com</code> be able to make HTTP requests to <code>example.com:4000</code> or <code>api.example.com</code> or even <code>some-other-domain.com</code>?</p><p>On the one hand, browsers long allowed page authors to include images and script files served from other origins: this was how one could include a JavaScript library file hosted on a <a href="https://en.wikipedia.org/wiki/Content_delivery_network">Content Delivery Network (CDN)</a>. This resulted in an HTTP request to a different origin, so why not let JavaScript do that directly?</p><p>On the other hand, there were some very significant security concerns with allowing cross-origin requests initiated from JavaScript. Many sites use cookies to track authenticated sessions, and browsers automatically send any cookies they have for an origin when they make a request to it. If a user was signed-in to sensitive site like their bank, and if that user was lured to a malicious page on <code>evil.com</code>, JavaScript within that page could easily make HTTP requests to the user's bank, and the browser would happily send along the authenticated session cookie. Thus the malicious page could conduct transactions on the user's behalf without the user even knowing that it's occurring.</p><p>Not surprisingly, the browser vendors decided to restrict cross-origin HTTP requests made from JavaScript. This posed issues for emerging web services that wanted to provide APIs that were callable from any web application, regardless of what origin the application came from.</p><p>Several creative hacks were developed to make this possible, the most popular being the <a href="https://en.wikipedia.org/wiki/JSONP">JSONP technique</a>. But these were always acknowledged as short-term hacks that needed to be replaced by a long-term solution. The great minds of the Web got together to figure out how to enable open API web services without compromising security. The result was the <a href="https://www.w3.org/TR/cors/">Cross-Origin Resource Sharing</a> standard, more commonly referred to as CORS.</p><h2 id="sechowcorsworks">How CORS Works</h2><p>The CORS standard defines a few new HTTP headers, and some rules concerning how browsers and servers negotiate a cross-origin HTTP request from JavaScript. The rules discuss two different scenarios: simple requests, and more dangerous requests that require a preflight authorization request.</p><h3 id="secsimplerequests">Simple Requests</h3><p>Simple cross-origin requests are defined as follows:</p><ul><li>The method is GET, HEAD, or POST</li><li>The request may contain only "safe" headers, such as <code>Accept</code>, <code>Accept-Language</code>, <code>Content-Type</code>, and <code>Viewport-Width</code>. These headers are considered safe because they only provide harmless meta-data, and are not typically used during data-mutating requests.</li><li>If a <code>Content-Type</code> header is included, it may only be one of the following:<ul><li><code>application/x-www-form-urlencoded</code> (format used when posting an HTML <code>&lt;form&gt;</code>)</li><li><code>multipart/form-data</code> (format used when posting an HTML <code>&lt;form&gt;</code> with <code>&lt;input type="file"&gt;</code> fields)</li><li><code>text/plain</code> (just plain text)</li></ul></li></ul><p>If JavaScript in a page makes an HTTP request that meets these conditions, the browser will send the request to the server, adding an <code>Origin</code> header set to the current page's origin. The server may use this <code>Origin</code> request header to determine where the request came from, and decide if it should process the request.</p><p>If the server does process the request and responds with a 200 (OK) status code, it must also include a response header named <code>Access-Control-Allow-Origin</code> set to the value in the <code>Origin</code> request header, or <code>*</code>. This tells the browser that it's OK to let the client-side JavaScript see the response.</p><p>This header protects older servers that were built before the CORS standard, and are therefore not expecting cross-origin requests to be allowed. Since this header was defined with the CORS standard, older servers will not include it in their responses, so the browser will block the client-side JavaScript from seeing those responses.</p><p>Supporting simple cross-origin requests on the server-side is therefore as simple as adding one header to your response: <code>Access-Control-Allow-Origin: *</code>. If you want to restrict access to only a small set of white-listed origins, you can compare the <code>Origin</code> request header against that list and respond accordingly.</p><h3 id="secpreflightrequests">Preflight Requests</h3><p>If the client-side JavaScript makes a cross-origin request that doesn't conform to the restrictive simple request criteria, the browser does some extra work to determine if the request should be sent to the server. The browser sends what's known as a "preflight request," which is a separate HTTP request for the same resource path, but using the <code>OPTIONS</code> HTTP method instead of the actual request method. The browser also adds the following headers to the preflight request:</p><ul><li><code>Access-Control-Request-Method</code> set to the method the JavaScript is attempting to use in the actual request.</li><li><code>Access-Control-Request-Headers</code> set to a comma-delimited list of non-safe headers the JavaScript is attempting to include in the actual request.</li></ul><h2 id="seccorsmiddlewareingo">CORS Middleware in Go</h2></div></div></main><footer class="footer"><div class="container"><div class="content"><p>Created by <a href="https://ischool.uw.edu/people/faculty/dlsinfo">Dave Stearns</a>, <a href="https://ischool.uw.edu">The Information School</a>, <a href="https://uw.edu">University of Washington</a></p><p><a href=".."><span class="icon"><i class="fa fa-home"></i> </span>back to contents</a></p></div></div></footer><script>var headings=document.querySelectorAll("h2,h3,h4,h5");headings.forEach(function(e){var a=document.createElement("a");a.textContent="#",a.href="#"+e.id,a.classList.add("bookmark-link"),e.appendChild(a)})</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-102177301-1","auto"),ga("send","pageview")</script></body></html>