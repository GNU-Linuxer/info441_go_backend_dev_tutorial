<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="../lib/bulma.min.css"><link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="../lib/prism.css"><link rel="icon" href="../img/page-icon.png"><meta property="og:type" content="website"><meta property="og:site_name" content="INFO Tutorials"><meta property="og:title" content="Talking to Databases from Go"><meta property="og:description" content="Interacting with persistent relational and document-oriented DBMSs"><meta property="og:image" content="https://drstearns.github.io/tutorials/img/page-icon.png"><title>Talking to Databases from Go</title><style>.is-funky{background-image:linear-gradient(to right,#006064,#880E4F)}.is-funky .subtitle,.is-funky .title{color:#fff}.screenshot{border:1px dotted #ccc;padding:10px}.bookmark-link{color:#ddd;margin-left:.25em}.home-link{color:#eee}.home-link:hover{color:#fff}.byline{font-size:.85rem;font-style:italic}</style></head><body><header><div class="hero is-funky"><div class="hero-body"><div class="container"><div class="columns is-mobile"><div class="column"><h1 class="title">Talking to Databases from Go</h1><p class="subtitle">Interacting with persistent relational and document-oriented DBMSs</p></div><div class="column is-narrow"><a href=".." class="home-link"><span class="icon is-medium"><i class="fa fa-home" aria-hidden="true" aria-label="back to table of contents"></i></span></a></div></div></div></div></div></header><main class="section"><div class="container"><div class="content"><p class="byline">Last edited on Aug 7, 2017 by <a href="https://ischool.uw.edu/people/faculty/dlsinfo">Dave Stearns</a></p><p>Web-based information systems need to store and manage large amounts of data, so they typically enlist the help of a persistent database management system (DBMS). These are separate server processes that encapsulate and manage the actual data and index files on disk, while supporting simultaneous access by multiple clients.</p><p>This tutorial assumes you've already taken <a href="https://www.washington.edu/students/crscat/info.html#info340">a relational DBMS course</a> and already know the basics of the Structure Query Language (SQL). I will show you how to interact with a relational DBMS from Go, and how to avoid SQL injection attacks.</p><p>I will also show you how to interact with the popular document-oriented DBMS MongoDB. As opposed to a relational database that stores data in flat tables with columns, MongoDB stores full JSON documents that can have arbitrary schema, nested objects, arrays, etc. This flexibility is handy for many types of information systems, but it does come with a few trade-offs that I will discuss in more detail below.</p><h2 id="secinteractingwithrelationaldbmss">Interacting with Relational DBMSs</h2><p>In order to interact with a relational database from Go, we need a relational DBMS instance we can connect to and play with. Since you know how to use <a href="../docker/">Docker</a>, we can use it to spin-up any of the popular open-source relational DBMSs: MySQL/MariaDB, PostgreSQL, etc. There are endless debates about which of these is the best choice, and in truth, the answer depends on what you need the DBMS to do and how willing you are to tune it.</p><p>For purposes of this tutorial, let's use MySQL, though the code will be nearly identical if you choose a different DBMS. The only real differences will be which package you import, and which dialect of SQL you use for your queries.</p><h3 id="secrunningthemysqldockercontainer">Running the MySQL Docker Container</h3><p>Like many relational DBMSs, MySQL implements its own security system, with its own user accounts and passwords that are distinct from the host operating system. New instances automatically have one super-user account, known as <code>root</code>, but you need to supply the password you want that account to have. Let's start by defining a new environment variable to hold this password. Enter this into a new terminal window:</p><pre class="language-bash"><code class="language-bash"><span class="token function">export</span> MYSQL_ROOT_PASSWORD<span class="token operator">=</span><span class="token string">"some super-secret password"</span></code></pre><p>If you want a randomly-generated password, you can use the <code>rand</code> subcommand of <code>openssl</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># generate 18 random bytes and base64 encode them</span>
<span class="token function">export</span> MYSQL_ROOT_PASSWORD<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>openssl rand -base64 18<span class="token variable">)</span></span>
<span class="token comment" spellcheck="true"># echo it so that you can see what it generated</span>
<span class="token keyword">echo</span> <span class="token variable">$MYSQL_ROOT_PASSWORD</span></code></pre><p>This sets the environment variable in the host shell, but remember that Docker containers are completely isolated by default, so we need to forward this environment variable into the container when we run it using the <code>-e</code> flag on the <code>docker run</code> command.</p><p>In production, we would run the MySQL container within a <a href="../sessions/#secrunningredis">Docker private network</a> so that it's accessible only by our other containers, but during development, you typically want to connect to it from your web server running directly on your host, so that you can quickly restart and debug it. So in this case, we also want to publish port 3306, which is the default MySQL port.</p><p>To start the MySQL server with these settings, use this command</p><pre class="language-bash"><code class="language-bash">docker run -d \
-p 3306:3306 \
--name testmysql \
-e MYSQL_ROOT_PASSWORD<span class="token operator">=</span><span class="token variable">$MYSQL_ROOT_PASSWORD</span> \
mysql</code></pre><p>Here we use the <code>-e</code> flag to set the <code>MYSQL_ROOT_PASSWORD</code> environment variable within the container. The value we use for this variable is the current value of the same variable name defined in our host shell (<code>$MYSQL_ROOT_PASSWORD</code>). This effectively forwards the environment variable into the container, though there is no lasting relationship between the two variables: if you change the variable defined in your host shell, it will have no effect on the variable defined within the running container.</p><p>Use <code>docker ps</code> to make sure the server is running. If it's not listed, use <code>docker logs testmysql</code> to see what error it wrote to the log file.</p><p>If you want to connect to this running MySQL instance using the MySQL CLI, you can run another container instance, overriding the default entry point:</p><pre class="language-bash"><code class="language-bash">docker run -it \
--rm \
--network host \
mysql sh -c <span class="token string">"mysql -h127.0.0.1 -uroot -p<span class="token variable">$MYSQL_ROOT_PASSWORD</span>"</span></code></pre><p>You've seen <a href="../docker/">many of these flags</a> before, but the <code>--network host</code> might be new to you. This tells Docker to run this container using the host machine's network stack rather than its own isolated network stack. When using this setting, the container's network can see everything your host's network can see, including that published 3306 port from the other MySQL container.</p><p>The expression <code>sh -c "mysql -h127.0.0.1 -uroot -p$MYSQL_ROOT_PASSWORD"</code> that follows the <code>mysql</code> container image name overrides the default entry point command for that container, running the MySQL CLI instead. That CLI needs to know the host, user, and password to use when connecting, and we supply those values in the command arguments. Since we used double-quotes around the command, our host's shell will expand the <code>$MYSQL_ROOT_PASSWORD</code> environment variable we set earlier, and pass that expanded value into the container when it starts.</p><p>If all goes well, you should now be at a MySQL CLI prompt, talking to your MySQL server container. Try executing the <code>show databases;</code> query to see the default list of databases, and <code>select version();</code> to get the database version number.</p><p>Execute the <code>exit</code> command to exit the CLI and return to your host prompt. Since we used the <code>--rm</code> flag, this CLI container will automatically be removed after it exits, but the server container will continue running. Use <code>docker ps</code> to verify.</p><h3 id="secinstallingthemysqlclientpackage">Installing the MySQL Client Package</h3><p>Relational databases are very similar to each other, and it's not uncommon for a project to switch engines over time. To make this easier, the Go standard library defines a common set of functions and structs in the <a href="https://golang.org/pkg/database/sql/">database/sql</a> package that are used when interacting with any relational DBMSs. This code in turn uses an easily-replaceable RDBMS-specific package, known as a <strong>driver</strong>, to actually communicate with the database. These drivers implement the interfaces defined in the <a href="https://golang.org/pkg/database/sql/driver/">database/sql/driver</a> package for the specific RDBMS protocol.</p><p>To install the <a href="https://github.com/go-sql-driver/mysql">MySQL diver for Go</a> on your system, use this command:</p><pre class="language-bash"><code class="language-bash">go get github.com/go-sql-driver/mysql</code></pre><p>If it worked, you won't see any output: no news is good news!</p><h3 id="secconnectingfromagoprogram">Connecting From a Go Program</h3><p>Now let's see how to connect to our MySQL server instance from a Go program. Create a new directory at <code>$GOPATH/src/mysqldemo</code>, and in that directory create a new file named <code>main.go</code>. Add this code to that file:</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"database/sql"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"os"</span>

    <span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//create the data source name, which identifies the</span>
    <span class="token comment" spellcheck="true">//user, password, server address, and default database</span>
    dsn <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"root:%s@tcp(127.0.0.1:3306)/"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">"MYSQL_ROOT_PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//create a database object, which manages a pool of</span>
    <span class="token comment" spellcheck="true">//network connections to the database server</span>
    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error opening database: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//ensure that the database gets closed when we are done</span>
    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//for now, just ping the server to ensure we have</span>
    <span class="token comment" spellcheck="true">//a live connection to it</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error pinging database: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"successfully connected!\n"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>To run this program, execute this at the command line:</p><pre class="language-bash"><code class="language-bash">go run main.go</code></pre><p>The <code>_ "github.com/go-sql-driver/mysql"</code> import line might look strange, but it is essentially importing the MySQL driver without creating a local name for the package in our code. Since we will be using only the common functions and structs in the <code>database/sql</code> package, we will never need to call the MySQL driver directly. As you might have noticed before, Go requires that you actually use all variables you declare, and package names are just like variables, so if you import a package but never use anything from it, the Go compiler will generate an error, and the <code>goimports</code> tool will simply remove the import. But if we don't import the package, its code won't be in our built executable, which will cause an error at runtime. To import a package that you never call, you can assign the blank identifier (<code>_</code>) to the imported package. This ensures the package gets into your built executable, but avoids the compile error you'd normally get from not calling any functions within that package.</p><p>The code in <code>main()</code> starts by creating a <strong>data source name</strong> string, the <a href="https://github.com/go-sql-driver/mysql#dsn-data-source-name">format</a> of which is defined by the MySQL driver package. Here we tell it to connect as the <code>root</code> user, supplying the value of the <code>MYSQL_ROOT_PASSWORD</code> environment variable as the password. We also specify that we want to connect to the server via TCP/IP at the address <code>127.0.0.1:3306</code>. The final <code>/</code> separates the host address from the default database name you want to connect to. If you leave that name blank (as we've done here), you will be connected but not in any particular database.</p><p>The <code>sql.DB</code> object returned from the <code>sql.Open()</code> function is actually a reference to a whole pool of connections to the database server. A Go web server processes HTTP requests concurrently, and each request may need to interact with the database. Since you can execute only one query at a time on a given database connection, the Go SQL package automatically maintains a pool of those connections, creating new ones as necessary to ensure that none of your HTTP requests are blocked waiting to talk to the database.</p><p>Since new connections are only made as needed, the last bit of code here just pings the server to ensure that we are able to connect to it. You don't typically need to do this, as it will open a connect the first time you query the database, but for now this will ensure that your Go program can actually connect and interact with the server.</p><h3 id="secbootstrappingthedatabaseschema">Bootstrapping the Database Schema</h3><p>The MySQL database container starts clean with only the basic system databases, so you need to bootstrap the server with your own database and schema. You can do this from your Go program by executing <code>create database</code> and <code>create table</code> queries:</p><pre class="language-go"><code class="language-go">    <span class="token comment" spellcheck="true">//create a database named "demo" if it doesn't already exist</span>
    <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"create database if not exists demo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error creating database: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//use that new database</span>
    <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">"use demo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error using database: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//create a new table in the database named "contacts"</span>
    <span class="token comment" spellcheck="true">//with columns for an auto-incremented ID, email</span>
    <span class="token comment" spellcheck="true">//first name, last name, etc.</span>
    sql <span class="token operator">:=</span> <span class="token string">`create table if not exists contacts (
        id int not null auto_increment primary key,
        email varchar(128) not null,
        first_name varchar(64) not null,
        last_name varchar(128) not null
    )`</span>
    <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error creating table: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span></code></pre><p>Alternatively, you can build your own Docker container image based on the MySQL image, adding a schema creation script that is automatically executed on startup. The Docker file is would be quite simple:</p><pre class="language-docker"><code class="language-docker"><span class="token keyword">FROM</span> mysql
<span class="token keyword">COPY</span> boostrap<span class="token punctuation">-</span>script.sql /docker<span class="token punctuation">-</span>entrypoint<span class="token punctuation">-</span>initdb.d/bootstrap<span class="token punctuation">-</span>script.sql</code></pre><p>All SQL commands within your <code>boostrap-script.sql</code> will be executed as the server starts. See the "Initializing a fresh instance" section of the <a href="https://hub.docker.com/_/mysql/">MySQL Docker container documentation</a> for details.</p><h3 id="secinsertingandgettingautoassignedids">Inserting and Getting Auto-Assigned IDs</h3><p>To insert new rows into the database, use the <code>db.Exec()</code> method, but also capture the first return value, which will get access to the newly assigned ID for the row:</p><pre class="language-go"><code class="language-go">    <span class="token comment" spellcheck="true">//insert a new row into the "contacts" table</span>
    <span class="token comment" spellcheck="true">//use ? markers for the values to defeat SQL</span>
    <span class="token comment" spellcheck="true">//injection attacks</span>
    sql <span class="token operator">=</span> <span class="token string">"insert into contacts(email, first_name, last_name) values (?,?,?)"</span>
    res<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token string">"test@test.com"</span><span class="token punctuation">,</span> <span class="token string">"Test"</span><span class="token punctuation">,</span> <span class="token string">"Tester"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error inserting new row: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//get the auto-assigned ID for the new row</span>
        id<span class="token punctuation">,</span> err <span class="token operator">:=</span> res<span class="token punctuation">.</span><span class="token function">LastInsertId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error getting new ID: %v\n"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ID for new row is %d\n"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre><h3 id="secguardingagainstsqlinjectionattacks">Guarding Against SQL Injection Attacks</h3><p>Many of the SQL statements you will execute from your web server will include values posted to your server by the web client. The first rule of web security is <strong>assume all requests are hostile</strong>, and the second is <strong>never trust data posted to your web server</strong>. Many amateur developers forget these rules and simply concatenate posted values into their SQL statements. For example <strong>you should never do this</strong>:</p><pre class="language-go"><code class="language-go"><span class="token comment" spellcheck="true">//NEVER DO THIS!</span>
searchQuereyFromClient <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">FormValue</span><span class="token punctuation">(</span><span class="token string">"q"</span><span class="token punctuation">)</span>
sql <span class="token operator">:=</span> <span class="token string">"select * from contacts where last_name='"</span> <span class="token operator">+</span> searchQueryFromClient <span class="token operator">+</span> <span class="token string">"*'"</span></code></pre><p>The trouble is that SQL is an interpreted language, and this approach allows clients to inject arbitrary code into your SQL that will be interpreted by the RDBMS. For example, many RDBMSs allow you to execute multiple statements at a time, separated by <code>;</code>, so a clever attacker would post the following search query to your server:</p><pre><code>'; drop table contacts; select 'a</code></pre><p>What concatenated as above, this results in the following SQL</p><pre><code>select * from contacts where last_name=''; drop table contacts; select 'a*'</code></pre><p>If you send this to your RDBMS, it will execute the first select statement, resulting in zero rows, then drop the entire contacts table, and finally select the static string "a*". As you might expect, the results would be rather damaging!</p><p>The correct way to incorporate values posted from a web client is to use parameter markers <code>?</code>, as shown in the previous section. The driver will ensure that these values are encoded or handled separately so that these kinds of SQL injection tricks won't succeed.</p><h3 id="secselectingrows">Selecting Rows</h3><p>When selecting rows, use the <code>db.Query()</code> method. This will execute the query and allow you to read one row at a time from the response stream. To work with the column values, we <strong>scan</strong> them into struct fields or variables:</p><pre class="language-go"><code class="language-go">    <span class="token comment" spellcheck="true">//Contact represents a contact record</span>
    <span class="token keyword">type</span> Contact <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        ID        <span class="token builtin">int</span>
        Email     <span class="token builtin">string</span>
        FirstName <span class="token builtin">string</span>
        LastName  <span class="token builtin">string</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//select rows from the table</span>
    rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"select id,email,first_name,last_name from contacts"</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">//ensure the rows are closed</span>
    <span class="token keyword">defer</span> rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//iterate over the returned rows, printing</span>
    <span class="token comment" spellcheck="true">//then to std out</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"rows\n-----\n"</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//while there are more rows</span>
    <span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//create a contact struct and scan</span>
        <span class="token comment" spellcheck="true">//the columns into the fields</span>
        contact <span class="token operator">:=</span> Contact<span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>contact<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token operator">&amp;</span>contact<span class="token punctuation">.</span>Email<span class="token punctuation">,</span>
            <span class="token operator">&amp;</span>contact<span class="token punctuation">.</span>FirstName<span class="token punctuation">,</span> <span class="token operator">&amp;</span>contact<span class="token punctuation">.</span>LastName<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error scanning row: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">//print the struct values to std out</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d, %s, %s, %s\n"</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> contact<span class="token punctuation">.</span>Email<span class="token punctuation">,</span>
            contact<span class="token punctuation">.</span>FirstName<span class="token punctuation">,</span> contact<span class="token punctuation">.</span>LastName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//if we got an error fetching the next row, report it</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> rows<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"error getting next row: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span></code></pre><p>There are a few things to note here. First, Go doesn't buffer the entire result set in memory, which would be enormous. Instead, the <code>.Query()</code> method returns a <code>sql.Rows</code> object, which lets you load one row at time into memory, and scan the columns into struct fields or variables. Each time you call <code>rows.Next()</code>, the internal current row buffer is overwritten with the next row data, so only one row remains in memory at a time.</p><p>Second, to actually work with the column data, you have to scan it into struct fields or variables. This is done using the <code>rows.Scan()</code> method, passing the address of the target fields/variables. The order of the arguments you pass to <code>.Scan()</code> should match the order of the columns in your <code>select</code> SQL statement. Ensure that the data type of your target field/variable is compatible with the data in the source column.</p><p>Third, errors could happen at any point: executing the select query; reading the next row; or scanning column values. Check for returned errors and report them in whatever way makes sense for your application. Here we just write to standard out, but in a web server, you'd use the <code>http.Error()</code> function instead.</p><h2 id="secinteractingwithmongodb">Interacting with MongoDB</h2></div></div></main><footer class="footer"><div class="container"><div class="content"><p>Created by <a href="https://ischool.uw.edu/people/faculty/dlsinfo">Dave Stearns</a>, <a href="https://ischool.uw.edu">The Information School</a>, <a href="https://uw.edu">University of Washington</a></p><p><a href=".."><span class="icon"><i class="fa fa-home"></i> </span>back to contents</a></p></div></div></footer><script>var headings=document.querySelectorAll("h2,h3,h4,h5");headings.forEach(function(e){var a=document.createElement("a");a.textContent="#",a.href="#"+e.id,a.classList.add("bookmark-link"),e.appendChild(a)})</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-102177301-1","auto"),ga("send","pageview")</script></body></html>