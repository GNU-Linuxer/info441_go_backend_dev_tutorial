<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="../lib/bulma.min.css"><link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="../lib/prism.css"><link rel="icon" href="../img/page-icon.png"><meta property="og:type" content="website"><meta property="og:site_name" content="INFO Tutorials"><meta property="og:title" content="The Model-View-Controller (MVC) Architecture"><meta property="og:description" content="How complex information applications are structured"><meta property="og:image" content="https://drstearns.github.io/tutorials/img/page-icon.png"><title>The Model-View-Controller (MVC) Architecture</title><style>.is-funky{background-image:linear-gradient(to right,#006064,#880E4F)}.is-funky .subtitle,.is-funky .title{color:#fff}.screenshot{border:1px dotted #ccc;padding:10px;margin-bottom:1em}.bookmark-link{color:#ddd;margin-left:.25em}.home-link{color:#eee}.home-link:hover{color:#fff}.byline{font-size:.85rem;font-style:italic}.shaded{background-color:#eee}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-SQFSBJB996"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SQFSBJB996")</script></head><body><header><div class="hero is-funky"><div class="hero-body"><div class="container"><div class="columns is-mobile"><div class="column"><h1 class="title">The Model-View-Controller (MVC) Architecture</h1><p class="subtitle">How complex information applications are structured</p></div><div class="column is-narrow"><a href=".." class="home-link"><span class="icon is-medium"><i class="fa fa-home" aria-hidden="true" aria-label="back to table of contents"></i></span></a></div></div></div></div></div></header><main class="section"><div class="container"><div class="content"><p class="byline">Last edited on Oct 23, 2021 by <a href="https://ischool.uw.edu/people/faculty/dlsinfo">Dave Stearns</a></p><p>In the <a href="../eventarch/">Event-Driven Architecture Tutorial</a> I showed you how to build interactive web applications using event listener functions that modify the application's state and re-render that state to the page. That architecture was a simple form of a much more pervasive and powerful architectural pattern known as <strong>Model-View-Controller (MVC)</strong>. Most JavaScript application frameworks are based on some variation of the MVC pattern, so before we dive into learning one of those frameworks, we should try to understand the MVC pattern in general. This will also help you understand what those frameworks are actually doing for you.</p><p>MVC was developed in the early days of personal computers, graphical user interfaces (GUIs), and object-oriented programming (OOP). These new platforms and tools enabled new kinds of interactive applications that required new approaches to code architecture. It was not at all immediately obvious how one should architect something as complex as a spreadsheet or word processing application. Developers experimented with many options before eventually settling on the MVC pattern. It worked so well that it became the standard architecture for GUI applications. Once JavaScript and the DOM matured, the MVC pattern was applied to client-side web applications as well, resulting in several competing libraries/frameworks (e.g., React, Angular, Vue, etc.).</p><p>To understand MVC, let's look at each of the concepts in turn, and see how they are applied in a simple JavaScript application.</p><h2 id="secmodels">Models</h2><p>The <strong>Model</strong> part of Model-View-Controller refers to a data objects that are being manipulated by the application. A model is simply an instance of a class (in the OOP sense) that is responsible for managing some chunk of data. It ensures that the data is created and modified correctly according to the rules of the application. The model is also responsible for raising an event when the data inside the model changes.</p><p>Note that models only care about the data they manage. Models do not render that data to the screen, nor do they handle saving that data to some kind of persistent data store. Their only concern is enforcing the application's rules regarding changes to those data, and notifying anyone who cares about changes to that data. Models are the most narcissistic of objects: they only know and care about about themselves.</p><p>For example, if we were to build a simple task list application using the MVC architecture, we would define two models: <code>Task</code> and <code>TaskList</code>. The <code>Task</code> model would manage the data for a specific task and enforce rules (e.g., the task title must be non-blank). The <code>TaskList</code> would manage the overall list of tasks. Both models would also allow callers to add event listener functions that will be called whenever the data inside the model changes, similar to how the DOM allows us to add an event listener function that is called when users click on elements or press keys on the keyboard.</p><h2 id="secviews">Views</h2><p>A <strong>view</strong> is an object that is responsible for rendering a model to an output device (typically the screen, but perhaps a printer). The view doesn't manage the data: that's the model's job. The view just reads the data from the model and renders it to the output device. It also listens for change events raised by the model and automatically re-renders itself whenever the model changes.</p><p>How the view renders the model is up to the view, and different views might render the same model in different ways. For example, a <code>TaskListView</code> might render a <code>TaskList</code> model as a simple bulleted list, but a <code>TaskCalendarView</code> might render the <code>TaskList</code> as a set of events on a calendar, and a <code>TaskSummaryView</code> might render some summary statistics like the number of completed and uncompleted tasks. All of those views could render the same <code>TaskList</code>, and all of them could render to the screen <em>at the same time</em>. Since they are all rendering the same model, any changes to that model would cause all views to automatically re-render so that they always show the correct up-to-date data.</p><h2 id="seccontrollers">Controllers</h2><p>A <strong>controller</strong> is an object that is responsible for loading/saving models from/to persistent storage, and connecting those models to views. In the original MVC architecture, the controller was also the component responsible for handling user events (mouse and keyboard interactions) and updating the models in response. In more recent variations of MVC, the views assume that responsibility, as they are the ones creating the on-screen elements, and are thus better equipped to handle the events raised by those elements. In this newer style, views know about models, but they do not know anything about the controllers that connect them to those models.</p><p>The following illustrates these relationships:</p><p><img src="img/mvc.png" alt="mvc architectural diagram"></p><h2 id="secmvcinjavascript">MVC in JavaScript</h2><p>Let's see how this MVC architecture would be applied to a web application written in JavaScript. Since MVC is an object-oriented architecture, I will use the new <a href="../es6/">ES6 Class Syntax</a> to define the various components. Note that this class syntax may not be supported in older browsers, but it can be compiled to simpler JavaScript that all browsers can understand using <a href="http://babeljs.io/">Babel</a>.</p><h3 id="secmodels-1">Models</h3><p>Let's start by creating a base class for all models. This base class will manage a list of change event listener functions that will be invoked whenever the model needs to inform listeners that its data has changed. As I define the methods of this class, I'll also add <a href="http://usejsdoc.org/">JSDoc</a> annotations to provide some typing information for parameters that editors like Visual Studio Code can leverage and enforce.</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
 * Base class for all models
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//array of change event listeners</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Adds a listener function that will be called when the model changes
     * @param {function} listener 
     * @returns {Model}
     */</span>
    <span class="token function">addChangeListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//push the new listener function into the array</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Removes a change listener function
     * @param {function} listener 
     * @returns {Model}
     */</span>
    <span class="token function">removeChangeListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//filter out the listener to remove</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_listeners <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_listeners<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>l <span class="token operator">=</span><span class="token operator">></span> l <span class="token operator">!==</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Raises an change event
     * @returns {Model}
     */</span>
    <span class="token function">raiseChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//call the listener functions</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>listener <span class="token operator">=</span><span class="token operator">></span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Bubbles change events from another model up through this one
     * @param {Model} model 
     * @returns {Model}
     */</span>
    <span class="token function">bubbleChange</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raiseChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>The <code>_</code> prefix on <code>_listeners</code> is a common idiom that JavaScript developers use to signal that <code>_listeners</code> should be treated as an internal private property. Since JavaScript doesn't have a <code>private</code> keyword, and since all JavaScript objects are really just maps, it's difficult to truly hide and protect a property from calling code. To help other developers understand that this property is something they shouldn't mess with, we use a prefix like <code>_</code> to signal that it should be treated as if it was a private data member.</p><p>The <code>raiseChange()</code> method will be called by subclasses whenever their data changes. This method will iterate over the array of listener functions and invoke each them in turn. Since functions are values in JavaScript, they can be added to an array as an element, and invoked while iterating those array elements. The <code>listener</code> parameter passed to the lambda function will be set to each listener function as it iterates the array. The expression <code>listener()</code> then invokes that function.</p><p>The <code>bubbleChange()</code> is used to bubble-up change events from a child model through a parent model. For example, our <code>TaskList</code> model will contain a list of <code>Task</code> models as children, and if one of those <code>Task</code> models change, we want to raise a change event from the <code>TaskList</code> model as well since it's contents have also changed. That way, any view listening for change events on the <code>TaskList</code> will be notified when one of the tasks within the list is changed, or when the overall list of tasks changes. This bubbling of events is done by adding a change listener to the child model that simply calls <code>raiseChange()</code> on the parent model.</p><h4 id="sectaskmodel">Task Model</h4><p>Now that we have a base class, let's define a model for a single <code>Task</code>. We will also use JSDoc to define a type named <code>TaskProps</code>, which will describe a simple JavaScript object with two properties: <code>title</code> and <code>done</code>. This simple map can be passed to the <code>Task</code> constructor to initialize it.</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
 * Represents a map of bare properties for a task
 * @typedef TaskProps
 * @property {string} title
 * @property {boolean} [done]
 */</span>

<span class="token comment" spellcheck="true">/**
 * Represents a single task
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * Constructs a new task with an optional
     * set of initial properties
     * @param {TaskProps} [props]
     */</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token operator">=</span> props<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_done <span class="token operator">=</span> props<span class="token punctuation">.</span>done<span class="token punctuation">;</span>            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Returns the task's title
     * @returns {string}
     */</span>
    <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Sets the task's title
     * @param {string} title 
     */</span>
    <span class="token keyword">set</span> <span class="token function">title</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title <span class="token operator">||</span> title<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"title must be non-blank"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token operator">=</span> title<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raiseChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Returns the task's done state
     * @returns {boolean}
     */</span>
    <span class="token keyword">get</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_done<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Sets the task's done state
     * @param {boolean} done 
     */</span>
    <span class="token keyword">set</span> <span class="token function">done</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_done <span class="token operator">=</span> done<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raiseChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Toggles the task's done state
     * @returns {Task}
     */</span>
    <span class="token function">toggleDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_done <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_done<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raiseChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Converts this model into a simple object for
     * JSON serialization
     * @returns {TaskProps}
     */</span>
    <span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            title<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_title<span class="token punctuation">,</span> 
            done<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_done
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>In typical Object-Oriented fashion, our <code>Task</code> class inherits all the methods from <code>Model</code> because it <code>extends</code> that class. But our constructor enhances the base class constructor by accepting a plain JavaScript object (i.e., a simple map) that may contain some initial values for <code>title</code> and <code>done</code>. So one can initialize a <code>Task</code> object like so:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">"Test"</span><span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This will come in handy when loading a list of tasks that we previously saved to a server or <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">local storage</a>.</p><p>We then add some specific methods for tasks, many of which use the relatively new getter/setter syntax from ES5. The function <code>get title()</code> will be invoked whenever code tries to get the <code>title</code> property from an instance of <code>Task</code> and the <code>set title()</code> will be invoked whenever code tries to set the <code>title</code> property. For example:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//this statement invokes `set title()`</span>
task<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Test"</span>
<span class="token comment" spellcheck="true">//and this statement invokes `get title()`</span>
<span class="token keyword">let</span> title <span class="token operator">=</span> task<span class="token punctuation">.</span>title<span class="token punctuation">;</span></code></pre><p>These getter/setter methods allow us to expose what appear to be simple properties on our model, but when they are set, our setter function gets a chance to validate the data and throw an error. We can use this to ensure that the title property is never set to a blank string.</p><blockquote><p><strong>Note:</strong> you could of course just call this method <code>setTitle()</code> and invoke it as such from other code. The only real difference is how the calling code interacts with the object: <code>task.title = "Test"</code> vs. <code>task.setTitle("Test")</code>. From the model's perspective, both approaches invoke a function that gets a chance to validate the data.</p></blockquote><p>All functions in the <code>Task</code> model that modify data call <code>this.raiseChange()</code>, which is a method we defined on the base <code>Model</code> class. This method iterates over all the change listener functions and invokes each. That way anyone who needs to know when this model's data changes will be notified.</p><p>The last method to explain is <code>toJSON()</code>. This method will be invoked if this object is passed to the <code>JSON.stringify()</code> method. This method converts JavaScript objects into the portable string-based format known as <a href="../ajax/#secjson">JSON</a> and by default it will encode all properties of the object. If you don't want that, you implement a <code>toJSON()</code> method and return whatever you do want the JSON encoder to encode. In our case, we only want the <code>_title</code> and <code>_done</code> properties to be encoded, and we want them to be encoded with the names <code>title</code> and <code>done</code>. So our <code>toJSON()</code> method returns a simple object with only those two properties.</p><h4 id="sectasklistmodel">TaskList Model</h4><p>Now that we have model for a single task, let's define another one for a list of tasks:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
 * Represents a list of tasks
 */</span>
<span class="token keyword">class</span> <span class="token class-name">TaskList</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * Constructs a new task list with
     * an optional array of task props
     * @param {TaskProps[]} [taskPropsArray]
     */</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>taskPropsArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//if a taskPropsArray was provided...</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskPropsArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//map it into an array of Task objects</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks <span class="token operator">=</span> taskPropsArray<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>tp <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span>tp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//bubble-up change events raised by the Task objects</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>task <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bubbleChange</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//initialize to an empty array</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Returns the total number of tasks
     * @returns {number}
     */</span>
    <span class="token keyword">get</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Returns the count of tasks that are done
     * @returns {number}
     */</span>
    <span class="token keyword">get</span> <span class="token function">doneLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> task<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> task<span class="token punctuation">.</span>done <span class="token operator">?</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> count<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Returns a new array containing all Task objects
     * that one can iterate over without disturbing the
     * master array maintained by this object
     * @returns {Task[]}
     */</span>
    <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Adds a new task to the list
     * @param {Task} task 
     */</span>
    <span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//push the new task into the array</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bubbleChange</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raiseChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Purges all done tasks from the list
     */</span>
    <span class="token function">purgeDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//filter the array of tasks to include only those</span>
        <span class="token comment" spellcheck="true">//that are not yet done</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">!</span>t<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raiseChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Converts this model into a simple object for
     * JSON serialization
     * @returns {Task[]}
     */</span>
    <span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_tasks<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>This class also extends <code>Model</code> and it's constructor also accepts an initialization property, but this time it's an simple JavaScript array of simple JavaScript objects, each of which can have a <code>title</code> and <code>done</code> property. This allows us to initialize a <code>TaskList</code> with a data array we receive from a server or read from local storage. Since it's an array, and since we essentially want to map each plain JavaScript object to a <code>Task</code> object, we use the <code>.map()</code> method. As you might remember from the <a href="../jsfunctional/">functional programming tutorial</a>, the <code>.map()</code> method invokes the provided function once for each element in the source array. Whatever that function returns is pushed into the output array. Here we return a new <code>Task()</code> that is initialized with the simple JavaScript object containing task properties. This allows us to initialize a <code>TaskList</code> like so:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//data we got from a server or from local storage</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">"Learn MVC"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">"Buy Dr Stearns a Tesla Roadster"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//create a new task list initialized with the data</span>
<span class="token keyword">let</span> taskList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskList</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//taskList now has two tasks</span>
taskList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// => 2</span>
taskList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title <span class="token comment" spellcheck="true">// => "Learn MVC"</span></code></pre><p>Note that during the constructor and the <code>add()</code> method, we also call <code>this.bubbleChange(task)</code> on each of the tasks in the list. As noted earlier, this will cause change events to bubble-up from individual tasks to the task list as a whole. In other words, when a single <code>Task</code> in the list raises a change event, the overall <code>TaskList</code> will raise a change event as well.</p><p>The use of <code>.slice()</code> in the <code>all()</code> method requires a little explanation. Calling <code>.slice(0)</code> on an array returns a shallow copy of that array, and this is what we want to return to the caller. We copy the array so that if the caller modifies the array's membership, it won't affect the <code>TaskList</code>. This requires calling code to add tasks to the list using <code>add()</code>, which guarantees that we can call <code>.bubbleChange()</code> and <code>.raiseChange()</code> to let listeners know about the new <code>Task</code> that was added to the list.</p><h3 id="secviews-1">Views</h3><p>Now that we have our models defined, we next need to create some view classes that can render those models. In a GUI system, views typically render by erasing an area of the screen and redrawing the pixels in that area. In a web browser, we need to render a bit differently. Instead of drawing pixels, we need to create, populate, and return a subtree of <em>HTML elements</em>. The browser then takes care of erasing the area where those elements should be and drawing the pixels to represent the elements. So our views essentially need to translate one data structure into another. They should have a <code>render()</code> method that returns a tree of HTML elements that we can append into the existing page.</p><p>Let's start by defining a <code>View</code> base class, just like we defined a <code>Model</code> base class. This <code>View</code> base class doesn't have to do much at present, but by defining one, we can always add functionality to the base class later, and all derived classes will automatically inherit it.</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * Returns an HTML element that contains the rendered view
     * @returns {HTMLElement}
     */</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> undefined<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Next let's define a subclass that can render a <code>TaskList</code> as a simple unordered HTML list (<code>&lt;ul&gt;</code> and <code>&lt;li&gt;</code> elements).</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
 * Renders a TaskList as a simple unordered list
 */</span>
<span class="token keyword">class</span> <span class="token class-name">TaskListView</span> <span class="token keyword">extends</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * Constructs the view
     * @param {TaskList} taskList 
     */</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>taskList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_taskList <span class="token operator">=</span> taskList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//create a &lt;ul> for the list</span>
        <span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//for each Task in the list...</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_taskList<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>task <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//create an &lt;li> and append it to the &lt;ul></span>
            <span class="token keyword">let</span> li <span class="token operator">=</span> ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//set the textContent to the task title</span>
            li<span class="token punctuation">.</span>textContent <span class="token operator">=</span> task<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//add a "clickable" style class which we will</span>
            <span class="token comment" spellcheck="true">//define in our CSS</span>
            li<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"clickable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//if the task is marked as done, add a "done"</span>
            <span class="token comment" spellcheck="true">//style class, which we will define in our CSS</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                li<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">//add a click event listener that calls toggleDone()</span>
            li<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> task<span class="token punctuation">.</span><span class="token function">toggleDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//return the &lt;ul> element</span>
        <span class="token keyword">return</span> ul<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="seccontroller">Controller</h3><p>The controller is responsible for loading models from storage, saving them back to storage, and connecting models with views. In a JavaScript web application, the controller's code is often just statements at the global score that run when the page first loads. You can create a class, and then instantiate that class on page load, but it's often unnecessary to do so.</p><h4 id="secstorage">Storage</h4><p>Let's start by seeing how we can load our <code>TaskList</code> from local storage. The <code>localStorage</code> object in the DOM gives our page access to a private space where we can save some data on the client. That space is private to your page's <strong>origin</strong>, which is the combination of the protocol (<code>http</code> or <code>https</code>) used to load your page, the host name the page came from (e.g., <code>ischool.uw.edu</code>), and the port number on that host the browser is talking to (by default <code>80</code> for <code>http</code> or 443 for <code>https</code>, but servers can listen on any port they wish). Any page loaded from the same origin has access to the same local storage space, and pages loaded from a different origin will have a separate local storage space.</p><p>The <code>localStorage</code> API acts like a key/value store, which is like a persistent map. You may store many keys with associated values, and you can ask for the value associated with any key. The one catch is that all keys and values must be strings. Thankfully any JavaScript Array or Object can be encoded into a string using <code>JSON.stringify()</code> and parsed back into an Array or Object using <code>JSON.parse()</code>.</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//load saved tasks from storage and parse them into a simple JavaScript array</span>
<span class="token keyword">let</span> taskProps <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"tasks"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//create a TaskList initializing it with the array</span>
<span class="token keyword">let</span> taskList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskList</span><span class="token punctuation">(</span>taskProps<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>localStorage.getItem()</code> method returns a JSON string previously saved to local storage associated with the <code>"tasks"</code> key. We then parse this into a JavaScript array of objects using <code>JSON.parse()</code> (more on JSON format in the <a href="../ajax/#secjson">Making HTTP Requests Tutorial</a>). Since our <code>TaskList</code> accepts an array of objects as an initializer, we can simply pass this to the constructor to reload our previously-saved tasks.</p><p>That loads the tasks, but now we also need to save them whenever the <code>TaskList</code> changes. Thankfully we already defined a mechanism that lets one register a function to be called whenever the model changes. We can use that to re-save the list each time it changes:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//add a change listener that re-saves the task list to local storage</span>
taskList<span class="token punctuation">.</span><span class="token function">addChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">"tasks"</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>taskList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here we use the <code>JSON.stringify()</code> method to encode the <code>TaskList</code> back into a JSON string, and <code>.setItem()</code> to save that string to local storage.</p><h4 id="secconnectingmodelstoviews">Connecting Models to Views</h4><p>After loading the <code>TaskList</code> from storage, the controller needs to create the view and connect it to the model. That requires just one line of code.</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//create the task list view and pass it a reference to the model</span>
<span class="token keyword">let</span> taskListView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskListView</span><span class="token punctuation">(</span>taskList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="secrendering">Rendering</h4><p>Now that we have a model, and a view connected to that model, we just need to render the view into an existing element, and re-render it whenever the model changes. We can use a few helper functions to keep this clean.</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**
 * Renders the overall app view to the parent element
 * @param {View} appView 
 * @param {HTMLElement} parentElement 
 */</span>
<span class="token keyword">function</span> <span class="token function">renderAppView</span><span class="token punctuation">(</span>appView<span class="token punctuation">,</span> parentElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//clear any content that might be there already</span>
    parentElement<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//render the app view into that parent element</span>
    parentElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>appView<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * Renders the main application view
 * @param {Model} appModel
 * @param {View} appView 
 * @param {HTMLElement} parentElement 
 */</span>
<span class="token keyword">function</span> <span class="token function">renderApp</span><span class="token punctuation">(</span>appModel<span class="token punctuation">,</span> appView<span class="token punctuation">,</span> parentElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//render the app view</span>
    <span class="token function">renderAppView</span><span class="token punctuation">(</span>appView<span class="token punctuation">,</span> parentElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//add a change listener to the app model that automatically</span>
    <span class="token comment" spellcheck="true">//re-renders the app view whenever the model changes</span>
    appModel<span class="token punctuation">.</span><span class="token function">addChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">renderAppView</span><span class="token punctuation">(</span>appView<span class="token punctuation">,</span> parentElement<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">renderApp</span><span class="token punctuation">(</span>taskList<span class="token punctuation">,</span> taskListView<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#app"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>renderAppView()</code> function clears the parent element and appends whatever the view returns from its <code>render()</code> method. The <code>renderApp()</code> function calls that function once to do the initial render, and then adds a change event listener function that calls it again whenever the model changes. That way the elements in the web page will always be up-to-date with the data in the model!</p><h2 id="secbettermvcframeworks">Better MVC Frameworks</h2><p>This example was fairly simple, and the way I wrote it isn't terribly efficient: each time the model changes, we completely clear the parent element and re-render everything. But this simplicity makes it easier to understand, and less error-prone, as we are always guaranteed that the page reflects the current state of the model. Current browsers are fairly efficient at redrawing, so if you run this you'll notice that the screen updates instantly and the app feel very snappy.</p><p>But as the models and views get larger and complex, all that modification of the DOM would start to get noticeable, both in terms of redraw performance and memory management. Thankfully, there are several MVC-like frameworks for JavaScript now that make it possible for us to write simple views that render their content, while minimizing the amount of elements that are destroyed and recreated each time we render (e.g., React, Vue). These frameworks use a bit of code in-between the views and the DOM that compare the rendered output of the views to what is already in the DOM. They then make the least amount of changes necessary to synchronize the two, resulting is far less DOM manipulation. These frameworks allow us to write large, sophisticated web applications based on the proven and reliable MVC pattern.</p></div></div></main><footer class="footer"><div class="container"><div class="content"><p>Created by <a href="https://ischool.uw.edu/people/faculty/dlsinfo">Dave Stearns</a>, <a href="https://ischool.uw.edu">The Information School</a>, <a href="https://uw.edu">University of Washington</a></p><p><a href=".."><span class="icon"><i class="fa fa-home"></i> </span>back to contents</a></p></div></div></footer><script>var headings=document.querySelectorAll("h2,h3,h4,h5");headings.forEach(function(e){var a=document.createElement("a");a.textContent="#",a.href="#"+e.id,a.classList.add("bookmark-link"),e.appendChild(a)})</script></body></html>